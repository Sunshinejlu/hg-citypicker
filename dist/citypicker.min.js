!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.CityPicker=b()}(this,function(){function a(a){return document.getElementById(a)}function b(a,b,c){var e,d=a.children;for(e=0;e<d.length;e++)d[e].style[b]=c}function c(a){a.parentNode.removeChild(a)}function d(a){this.inputId=a.inputId,this.data=a.data,this.valueKey=a.valueKey||"value",this.childKey=a.childKey||"child",this.success=a.success,this.cancel=a.cancel||null,this.beforeShow=a.beforeShow||function(){},this.title=a.title||"",this.sureText=a.sureText||"确定",this.cancelText=a.cancelText||"取消",this.a=a.a||.001,this.style=a.style,this.initTab(),this.initUI(),this.initEvent()}return d.prototype={constructor:d,initTab:function(){this.input=a(this.inputId),this.wrapId=this.inputId+"-wrap",this.relatedArr=[],this.cityIndex=[],this.liNum=[],this.ulCount=0,this.renderCount=0,this.liHeight=this.style&&this.style.liHeight?this.style.liHeight:40,this.btnHeight=this.style&&this.style.btnHeight?this.style.btnHeight:44,this.cityUl=[],this.curDis=[],this.curPos=[],this.startY=0,this.startTime=0,this.endTime=0,this.moveY=0,this.moveTime=0,this.moveNumber=1,this.moveSpeed=[],this.abled=!0,this.container=this.wrapId+"-container",this.box=this.wrapId+"-box",this.content=this.wrapId+"-content",this.abolish=this.wrapId+"-abolish",this.sure=this.wrapId+"-sure"},initUI:function(){this.createContainer(),this.relatedArr[0]=this.data,this.liNum[0]=this.relatedArr[0].length,this.cityIndex[0]=0,this.getRelatedArr(this.relatedArr[0][0],0),this.updateChildData(0),this.renderContent()},initEvent:function(){var b=this,c=b.wrap,d=a(b.container);a(b.inputId).addEventListener("click",function(){b.beforeShow()||b.show(c,d)}),a(b.sure).addEventListener("click",function(){b.success(b.getResult()),b.hide(c,d)}),a(b.abolish).addEventListener("click",function(){b.cancel&&b.cancel(),b.hide(c,d)}),c.addEventListener("click",function(a){a.target.id===b.wrapId&&(b.cancel&&b.cancel(),b.hide(c,d))})},createContainer:function(){var b=document.createElement("div");b.id=this.wrapId,document.body.appendChild(b),this.wrap=a(this.wrapId),this.wrap.classList.add("hg-picker-bg")},getRelatedArr:function(a,b){"object"==typeof a&&this.childKey in a&&a[this.childKey].length>0&&(this.relatedArr[b+1]=a[this.childKey],this.renderCount++,this.getRelatedArr(a[this.childKey][0],++b))},updateChildData:function(a){this.ulCount=a+1+this.renderCount;for(var b=a+1;b<this.ulCount;b++)this.liNum[b]=this.relatedArr[b].length,this.cityIndex[b]=0,this.curDis[b]=0},getValue:function(a){var c,b=[];for(c=0;c<a.length;c++)"object"==typeof a[c][this.valueKey]?b.push(a[c][this.valueKey][this.valueKey]):b.push(a[c][this.valueKey]);return b},renderContent:function(){var a,b;for(a=this.style&&"bottom"===this.style.btnLocation?'<div  class="hg-picker-container" id="'+this.container+'">'+'<div class="hg-picker-content" id="'+this.content+'">'+'<div class="hg-picker-up-shadow"></div>'+'<div class="hg-picker-down-shadow"></div>'+'<div class="hg-picker-line"></div>'+"</div>"+'<div class="hg-picker-btn-box" id="'+this.box+'">'+this.title+'<div class="hg-picker-btn" id="'+this.abolish+'">'+this.cancelText+"</div>"+'<div class="hg-picker-btn" id="'+this.sure+'">'+this.sureText+"</div>"+"</div>"+"</div>":'<div  class="hg-picker-container" id="'+this.container+'">'+'<div class="hg-picker-btn-box" id="'+this.box+'">'+this.title+'<div class="hg-picker-btn" id="'+this.abolish+'">'+this.cancelText+"</div>"+'<div class="hg-picker-btn" id="'+this.sure+'">'+this.sureText+"</div>"+"</div>"+'<div class="hg-picker-content" id="'+this.content+'">'+'<div class="hg-picker-up-shadow"></div>'+'<div class="hg-picker-down-shadow"></div>'+'<div class="hg-picker-line"></div>'+"</div>"+"</div>",this.wrap.innerHTML=a,b=0;b<this.ulCount;b++)this.renderUl(b),this.cityIndex[b]=0,this.curDis[b]=0*this.liHeight,this.bindRoll(b);this.setStyle(),this.setUlWidth()},setStyle:function(){var c,d,e,f,g,h,i,j;if(this.style){if(c=this.style,d=a(this.container),e=a(this.content),f=a(this.box),g=a(this.sure),h=a(this.abolish),i=e.children.length,40!==c.liHeight){for(j=0;j<this.ulCount;j++)b(e.children[j],"height",this.liHeight+"px");e.children[i-3].style.height=2*this.liHeight+"px",e.children[i-2].style.height=2*this.liHeight+"px",e.children[i-1].style.height=this.liHeight+"px",e.children[i-1].style.top=2*this.liHeight+"px",e.style.height=5*this.liHeight+"px",e.style.lineHeight=this.liHeight+"px"}44!==c.btnHeight&&(f.style.height=this.btnHeight+"px",f.style.lineHeight=this.btnHeight+"px"),c.btnOffset&&(g.style.marginRight=c.btnOffset,h.style.marginLeft=c.btnOffset),(40!==c.liHeight||44!==c.btnHeight)&&(d.style.height=5*this.liHeight+this.btnHeight+"px"),c.titleColor&&(f.style.color=c.titleColor),c.sureColor&&(g.style.color=c.sureColor),c.cancelColor&&(h.style.color=c.cancelColor),c.btnBgColor&&(f.style.backgroundColor=c.btnBgColor),c.contentColor&&(e.style.color=c.contentColor),c.contentBgColor&&(e.style.backgroundColor=c.contentBgColor),c.upShadowColor&&(e.children[i-3].style.backgroundImage=c.upShadowColor),c.downShadowColor&&(e.children[i-2].style.backgroundImage=c.downShadowColor),c.lineColor&&(e.children[i-1].style.borderColor=c.lineColor)}},renderUl:function(b){var c=a(this.content),d=document.createElement("ul");d.setAttribute("id",this.wrapId+"-ul-"+b),c.insertBefore(d,c.children[c.children.length-3]),this.cityUl[b]=a(this.wrapId+"-ul-"+b),this.renderLi(b)},renderLi:function(a){this.cityUl[a].innerHTML="";var c="<li></li><li></li>";this.getValue(this.relatedArr[a]).forEach(function(a){c+="<li>"+a+"</li>"}),c+="<li></li><li></li>",this.cityUl[a].innerHTML=c,40!==this.liHeight&&b(this.cityUl[a],"height",this.liHeight+"px")},setUlWidth:function(){for(var a=0;a<this.ulCount;a++)this.cityUl[a].style.width=(100/this.ulCount).toFixed(2)+"%"},bindRoll:function(a){var b=this;b.cityUl[a].addEventListener("touchstart",function(){b.touch(a)},!1),b.cityUl[a].addEventListener("touchmove",function(){b.touch(a)},!1),b.cityUl[a].addEventListener("touchend",function(){b.touch(a)},!0)},roll:function(a,b){(this.curDis[a]||0===this.curDis[a])&&(this.cityUl[a].style.transform="translate3d(0, "+this.curDis[a]+"px, 0)",this.cityUl[a].style.webkitTransform="translate3d(0, "+this.curDis[a]+"px, 0)",b&&(this.cityUl[a].style.transition="transform "+b+"s ease-out",this.cityUl[a].style.webkitTransition="-webkit-transform "+b+"s ease-out"))},touch:function(a){var c,d,b=b||window.event;switch(b.preventDefault(),b.type){case"touchstart":if(this.startTime=new Date,this.startTime-this.endTime<200)return this.abled=!1,void 0;this.abled=!0,this.startY=b.touches[0].clientY,this.curPos[a]=this.curDis[a],this.moveNumber=1,this.moveSpeed=[];break;case"touchmove":if(!this.abled)return b.preventDefault();this.moveY=b.touches[0].clientY,c=this.startY-this.moveY,this.curDis[a]=this.curPos[a]-c,this.curDis[a]>=1.5*this.liHeight&&(this.curDis[a]=1.5*this.liHeight),this.curDis[a]<=-1*(this.liNum[a]-1+1.5)*this.liHeight&&(this.curDis[a]=-1*(this.liNum[a]-1+1.5)*this.liHeight),this.roll(a),this.moveTime-this.startTime>=130*this.moveNumber&&(this.moveNumber++,this.moveSpeed.push(c/(this.moveTime-this.startTime)));break;case"touchend":if(!this.abled)return this.endTime=Date.now();d=1===this.moveNumber?(this.startY-b.changedTouches[0].clientY)/(this.endTime-this.startTime):this.moveSpeed[this.moveSpeed.length-1],this.curDis[a]=this.curDis[a]-this.calculateBuffer(d,this.a),this.fixate(a)}},calculateBuffer:function(a,b){return Math.abs(a)<.25?0:a/Math.abs(a)*(.5*a*a/b)},fixate:function(a){this.renderCount=0,this.getPosition(a),this.getRelatedArr(this.relatedArr[a][this.cityIndex[a]],a),this.updateChildData(a),this.updateView(a);for(var b=a;b<this.ulCount;b++)this.roll(b,.2)},getPosition:function(a){this.cityIndex[a]=this.curDis[a]<=-1*(this.liNum[a]-1)*this.liHeight?this.liNum[a]-1:this.curDis[a]>=0?0:-1*Math.round(this.curDis[a]/this.liHeight),this.curDis[a]=-1*this.liHeight*this.cityIndex[a]},updateView:function(b){var e,d=a(this.content).children.length-3;if(this.ulCount==d)for(e=b+1;e<this.ulCount;e++)this.renderLi(e);else if(this.ulCount>d){for(e=b+1;d>e;e++)this.renderLi(e);for(e=d;e<this.ulCount;e++)this.renderUl(e),this.bindRoll(e);this.setUlWidth()}else{for(e=b+1;e<this.ulCount;e++)this.renderLi(e);for(e=this.ulCount;d>e;e++)c(this.cityUl[e]);this.setUlWidth()}},getResult:function(){var b,a=[];for(b=0;b<this.ulCount;b++)a.push(this.relatedArr[b][this.cityIndex[b]]);return a},show:function(a,b){a.classList.add("hg-picker-bg-show"),b.classList.add("hg-picker-container-up")},hide:function(a,b){a.classList.remove("hg-picker-bg-show"),b.classList.remove("hg-picker-container-up")}},d});